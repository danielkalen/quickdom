!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("quickcss"),require("smart-extend"),require("@danielkalen/is")):"function"==typeof define&&define.amd?define(["quickcss","smart-extend","@danielkalen/is"],e):(t=t||self).quickdom=e(t.CSS,t.extend,t.IS_)}(this,function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function a(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n;var l,h=["id","name","type","href","selected","checked","className"],u=["id","ref","type","name","text","style","class","className","url","href","selected","checked","props","attrs","passStateToChildren","stateTriggers","unpassableStates"];(l=n.create("natives","dom")).load({quickDomEl:function(t){return t&&"QuickElement"===t.constructor.name},template:function(t){return t&&"QuickTemplate"===t.constructor.name}});var c,p,f,d=l;c=null,p=null,(f=function(){var t,e,n,i,r,s,o;for(e=new Array(arguments.length),i=r=0,s=arguments.length;r<s;i=++r)t=arguments[i],e[i]=t;return o=c.count,(n=f.create(e))&&n._postCreation&&c.count!==o&&n._postCreation(),n}).create=function(t){var e,n,i,r,s,o,l,h,u;switch(!1){case!d.array(t[0]):return f.apply(void 0,a(t[0]));case!d.template(t[0]):return t[0].spawn();case!d.quickDomEl(t[0]):return t[1]?t[0].updateOptions(t[1]):t[0];case!(d.domNode(t[0])||d.domDoc(t[0])):return t[0]._quickElement?t[0]._quickElement:(u=t[0].nodeName.toLowerCase().replace("#",""),(h=t[1]||{}).existing=t[0],new c(u,h));case t[0]!==window:return p;case!d.string(t[0]):if(h="text"===(u=t[0].toLowerCase())?d.object(t[1])?t[1]:{text:t[1]||""}:d.object(t[1])?t[1]:{},r=new c(u,h),t.length>2){for(i=new Array(e=t.length),s=1;++s<e;)i[s+1]=t[s];for(o=0,l=i.length;o<l;o++)n=i[o],d.string(n)&&(n=f.text(n)),d.array(n)&&(n=f.apply(void 0,a(n))),d.quickDomEl(n)&&r.append(n)}return r;case!(t[0]&&(d.domNode(t[0][0])||d.domDoc(t[0][0]))):return f(t[0][0])}},f.html=function(t){var e,n;return(n=document.createElement("div")).innerHTML=t,e=Array.prototype.slice.call(n.childNodes),f.batch(e)},f.isQuickEl=function(t){return d.quickDomEl(t)},f.isEl=function(t){return d.domEl(t)};var y,v=function(t,e){return t&&-1!==t.indexOf(e)},g=function(t,e){var n;return-1!==(n=t.indexOf(e))&&t.splice(n,1),t},_=function(t){switch(!1){case!d.string(t):return de.text(t);case!d.domNode(t):return de(t);case!d.template(t):return t.spawn();default:return t}},m=function(t){return"$"===t[0]||"@"===t[0]},b=function(e,n,i){var r,s,o,a,l,h;if(n||(n=0),r=S.get(e,n))return r;for(a={className:[t.register(e,n,i)],fns:[],rule:e},s=0,o=(h=Object.keys(e)).length;s<o;s++)"function"==typeof e[l=h[s]]&&a.fns.push([l,e[l]]);return S.set(e,a,n)},S=new(function(){function t(){r(this,t),this.keys=Object.create(null),this.values=Object.create(null)}return o(t,[{key:"get",value:function(t,e){var n;if(this.keys[e]&&-1!==(n=this.keys[e].indexOf(t)))return this.values[e][n]}},{key:"set",value:function(t,e,n){return this.keys[n]||(this.keys[n]=[],this.values[n]=[]),this.keys[n].push(t),this.values[n].push(e),e}}]),t}());y=/\s+/;var x=function(t,e,n,i){var r,s,o=this;if(null==this._eventCallbacks&&(this._eventCallbacks={__refs:{}}),d.string(t)&&d.function(e)){if(s=t.split("."),r=s[1],"inserted"===(t=s[0])&&this._inserted)return e.call(this,this._parent),this;t.split(y).forEach(function(t){var s;return o._eventCallbacks[t]||(o._eventCallbacks[t]=[],i||o._listenTo(t,function(e){return o._invokeHandlers(t,e)},n)),r&&(null==(s=o._eventCallbacks.__refs)[t]&&(s[t]={}),o._eventCallbacks.__refs[t][r]=e),o._eventCallbacks[t].push(e)})}return this},k=function(t,e){var n,i=this;return d.string(t)&&d.function(e)&&this.on(t,n=function(r){return i.off(t,n),e.call(i,r)}),this},w=function(t,e){var n,i,r,s=this;if(null==this._eventCallbacks&&(this._eventCallbacks={__refs:{}}),d.string(t))r=t.split("."),n=r[1],(t=r[0]).split(y).forEach(function(t){var i;if(s._eventCallbacks[t]){if(null==e&&(e=null!=(i=s._eventCallbacks.__refs[t])?i[n]:void 0),d.function(e))return g(s._eventCallbacks[t],e);if(!n)return s._eventCallbacks[t].length=0}});else for(i in this._eventCallbacks)this.off(i);return this},C=function(t){var n,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0;return t&&d.string(t)&&((n=document.createEvent("Event")).initEvent(t,r,s),o&&"object"===i(o)&&e(n,o),this.el.dispatchEvent(n)),this},O=function(t,e){var n;return t&&d.string(t)&&(null!=(n=this._eventCallbacks)?n[t]:void 0)&&this._invokeHandlers(t,e),this},E=function(t,e){var n,i,r;for(i=0,r=(n=this._eventCallbacks[t].slice()).length;i<r;i++)n[i].call(this,e)},j=function(t,e,n){var i,r;return r=this.el.addEventListener?"addEventListener":"attachEvent",i=this.el.addEventListener?t:"on".concat(t),this.el[r](i,e,n),this};var T,P=function(e){var n,i,r,s,o,a,l=this;if("text"!==this.type){if(n=arguments,d.string(e)){if(a="function"==typeof n[1]?n[1].call(this,this.related):n[1],null===n[1]&&d.defined(this.currentStateStyle(e))&&!d.function(this.currentStateStyle(e))&&(a=t.UNSET),a&&"function"==typeof a.then?a.then(function(n){return t(l.el,e,n,l.options.forceStyle)}):o=t(this.el,e,a,this.options.forceStyle),1===n.length)return this._inserted?o:o?"":o}else if(d.object(e))for(s=Object.keys(e),i=-1;r=s[++i];)this.style(r,e[r]);return this}},N=function(t,e){var n,i;if("text"!==this.type)return i=this.el.style[t],d.string(i)||d.number(i)?"function"==typeof(n=(e?0:this.style(t))||this.el.style[t]||this.currentStateStyle(t)||"")?n.call(this,this.related):n:this},q=function(t,e){return parseFloat(this.styleSafe(t,e))},A=function(t){var e,n,i,r;if(r=this._resolveFnStyles(this._getActiveStates(),!0),this.style(r),t)for(e=0,n=(i=this._children).length;e<n;e++)i[e].recalcStyle();return this},D=function(t){var e,n,i;if(t){if(this._state.length){var r;if(i=this._state.slice(),this._stateShared&&this._stateShared.length)(r=i).push.apply(r,a(this._stateShared));for(e=i.length;n=i[--e];)if(this._styles[n]&&d.defined(this._styles[n].rule[t]))return this._styles[n].rule[t]}if(this._styles.base)return this._styles.base.rule[t]}},R=function(){return this.style("display","none")},L=function(t){var e;return t||"none"!==(t=this.currentStateStyle("display"))&&t||(t="block"),null==t&&(t=(null!=(e=this._styles.base)?e.display:void 0)||"block"),this.style("display",t)},F={get:function(){return this.width>this.height?"landscape":"portrait"}},Q={get:function(){return this.width/this.height}};var I,B=T={type:"window",el:window,raw:window,_eventCallbacks:{__refs:{}}};T.on=x,T.off=w,T.emit=C,T.emitPrivate=O,T._listenTo=j,T._invokeHandlers=E,Object.defineProperties(T,{width:{get:function(){return window.innerWidth}},height:{get:function(){return window.innerHeight}},orientation:F,aspectRatio:Q}),I=/,\s*/;var H,z,M=new function(){var t,e;return t=[],window.addEventListener("resize",function(){var e,n;for(e=0,n=t.length;e<n;e++)(0,t[e])()}),this.parseQuery=function(t,e){var n,i,r;return n=e.split("("),r=n[0],r=function(){switch(r){case"window":return B;case"parent":return t.parent;case"self":return t;default:return t.parentMatching(function(t){return t.ref===r.slice(1)})}}(),i=n[1].slice(0,-1).split(I).map(function(t){var e,n,i,s,o,a,l;return a=t.split(":"),l=parseFloat(a[1]),isNaN(l)&&(l=a[1]),o=!(s="max-"===(i=(n=a[0]).slice(0,4)))&&"min-"===i,(s||o)&&(n=n.slice(4)),e=function(){switch(n){case"orientation":return function(){return r.orientation};case"aspect-ratio":return function(){return r.aspectRatio};case"width":case"height":return function(){return r[n]};default:return function(){var t,e;return e=r.style(n),t=parseFloat(e),isNaN(t)?e:t}}}(),{key:n,value:l,min:o,max:s,getter:e}}),{source:r,rules:i}},this.register=function(n,i){var r,s;return(s=this.parseQuery(n,i)).source&&(t.push(r=function(){return e(n,s,i)}),r()),s},e=function(t,e,n){var i,r,s,o,a,l;for(o=!0,r=0,s=(a=e.rules).length;r<s&&(l=a[r],i=l.getter(),o=function(){switch(!1){case!l.min:return i>=l.value;case!l.max:return i<=l.value;default:return i===l.value}}());r++);return t.state(n,o)},this},$=function(){function t(e){r(this,t),this.string=e.join("+"),this.array=e.slice(),this.length=e.length}return o(t,[{key:"includes",value:function(t){var e,n,i;for(e=0,n=(i=this.array).length;e<n;e++)if(i[e]===t)return!0;return!1}},{key:"without",value:function(t){return this.array.filter(function(e){return e!==t}).join("+")}},{key:"isApplicable",value:function(t,e){return this.array.filter(function(n){return n===t||-1!==e.indexOf(n)}).length===this.array.length}}]),t}();H={hover:{on:"mouseenter",off:"mouseleave",bubbles:!0},focus:{on:"focus",off:"blur",bubbles:!0}};var W=function(){var t,n,i,r,s;this.options.relatedInstance&&((t=this.options).related||(t.related=this.options.relatedInstance),this.options.relatedInstance=null),this.related=null!=(n=this.options).related?n.related:n.related=this,this.options.class&&(this.options.className=this.options.class),this.options.url&&(this.options.href=this.options.url),null==(i=this.options).unpassableStates&&(i.unpassableStates=[]),null==(r=this.options).passStateToChildren&&(r.passStateToChildren=!0),null==(s=this.options).passDataToChildren&&(s.passDataToChildren=!0),this.options.stateTriggers=this.options.stateTriggers?e.clone.deep(H,this.options.stateTriggers):H,"text"===this.type?e(this,this._parseTexts(this.options.text,this._texts)):e(this,this._parseStyles(this.options.style,this._styles))},J=function(t,e){var n,i,r,s,o,a,l,h,u,c,p,f,y,_,S;if(d.objectPlain(t)){if(S=Object.keys(t).filter(function(t){return m(t)}),p=g(S.slice(),"$base"),n=S.filter(function(t){return"@"===t[0]}).map(function(t){return t.slice(1)}),i=S.map(function(t){return t.slice(1)}),o=e||{},s=r=void 0,a=v(S,"$base")?t.$base:t,o.base=b(a,0,h=this.options.forceStyle),p.length)for(l=function(t,e,i){var a,u,c,p,f,d,y,v;for(p={},a=!1,u=0,c=(v=Object.keys(t)).length;u<c;u++)f=v[u],m(f)?(e.push(y=f.slice(1)),d=new $(e),null==s&&(s=[]),null==r&&(r=[]),r.push(d),"@"===f[0]&&n.push(y),o[d.string]=b(l(t[f],e,i+1),i+1,h)):(a=!0,p[f]=t[f]);if(a)return p},u=0,c=p.length;u<c;u++)_=(f=p[u]).slice(1),(y=l(t[f],[_],1))&&(o[_]=b(y,1));return{_styles:o,_mediaStates:n,_stateShared:s,_providedStates:i,_providedStatesShared:r}}},K=function(t,e){var n,i,r,s,o,a;if(d.objectPlain(t)){for(n=(a=Object.keys(t).map(function(t){return t.slice(1)})).filter(function(t){return"base"!==t}),i=e||{},i={base:""},r=0,s=a.length;r<s;r++)i[o=a[r]]=t["$"+o];return{_texts:i,_providedStates:n}}},U=function(){var t,e,n,i,r,s,o,a=this;if((i=this.options.id||this.options.ref)&&this.attr("data-ref",this.ref=i),this.options.id&&(this.el.id=this.options.id),this.options.className&&(this.el.className=this.options.className),this.options.src&&(this.el.src=this.options.src),this.options.href&&(this.el.href=this.options.href),this.options.type&&(this.el.type=this.options.type),this.options.name&&(this.el.name=this.options.name),this.options.value&&(this.el.value=this.options.value),this.options.selected&&(this.el.selected=this.options.selected),this.options.checked&&(this.el.checked=this.options.checked),this.options.props&&this.prop(this.options.props),this.options.attrs&&this.attr(this.options.attrs),this._applyRegisteredStyle(this._styles.base,null,null,this.options.styleAfterInsert),this._texts&&(this.text=this._texts.base),this.on("inserted",z,!1,!0),this.options.invokeComputersOnce&&(this._invokedComputers={}),this.options.recalcOnResize&&window.addEventListener("resize",function(){return a.recalcStyle()}),this.options.events)for(t in r=this.options.events)e=r[t],this.on(t,e);if(this.options.methods)for(n in s=this.options.methods)o=s[n],this[n]||(d.function(o)?this[n]=o:d.object(o)&&Object.defineProperty(this,n,{configurable:!0,get:o.get,set:o.set}));"text"!==this.type&&d.object(this.options.text)&&this.append(f("text",{text:this.options.text}))},G=function(t){this.options.computers&&(t&&this.options.data&&(t=e.clone(this.options.data,t)),t||(t=this.options.data),this.applyData(t,!1),this.options.computers._init&&this._runComputer("_init",t)),this.options.state&&this.state(this.options.state)},V=function(t){var e=this;Object.keys(this.options.stateTriggers).forEach(function(n){var i,r,s;if(s=e.options.stateTriggers[n],v(e._providedStates,n)||t||s.force)return r=d.string(s)?s:s.on,d.object(s)&&(i=s.off),e._listenTo(r,function(){return e.state(n,!0,s.bubbles)}),i?e._listenTo(i,function(){return e.state(n,!1,s.bubbles)}):void 0})},X=function(){var t;return t=void 0,Object.defineProperty(this,"_parent",{get:function(){return t},set:function(e){var n=this;(t=e)&&(this.parents.slice(-1)[0].raw===document.documentElement?this._unproxyParent(e):t.on("inserted",function(){if(t===e)return n._unproxyParent(e)}))}})},Y=function(t){delete this._parent,this._parent=t,this.emitPrivate("inserted",t)};z=function(){var t,e,n,i,r;if(this._inserted=this,this.options.styleAfterInsert&&this.recalcStyle(),(n=this._mediaStates)&&this._mediaStates.length){for(this._mediaStates=Object.create(null),r=[],t=0,e=n.length;t<e;t++)i=n[t],r.push(this._mediaStates[i]=M.register(this,i));return r}};var Z,tt=function(t){return rt(this,t)},et=function(t){var e,n;if(d.function(t)||(e=d.string(t)))for(n=this.parent;n;){if(e){if(n.ref===t)return n}else if(t(n))return n;n=n.parent}},nt=function(t){return f(this.raw.querySelector(t))},it=function(t){var e,n,i,r,s;for(r=[],e=0,i=(s=this.raw.querySelectorAll(t)).length;e<i;e++)n=s[e],r.push(n);return f.batch(r)},rt=function(t,e){var n,i,r;for(d.function(e)||(n=d.string(e))||(e=void 0),r=[],i=t.parent;i;)r.push(i),i=i.parent,n?i&&i.ref===e&&(i=null):e&&e(i)&&(i=null);return r},st=function t(e,n){var i,r,s,o,a,l,h;if(!n&&e._childRefs||(e._childRefs={}),h=e._childRefs,e.ref&&(h[e.ref]=e),(r=e.children).length)for(o=0,a=r.length;o<a;o++)for(l in i=t(r[o],n))s=i[l],h[l]||(h[l]=s);return h},ot=function(t,e){var n;return(n=t.parent)?n.children.filter(function(n){return n[e]===t[e]}).indexOf(t):null},at=function(t){var e,n,i,r;if(t.length){for(r=[],e=0,i=t.length;e<i;e++)"text"!==(n=t[e]).type&&r.push(n);return r}return t};f.query=function(t){return f(document).query(t)},f.queryAll=function(t){return f(document).queryAll(t)},Z=[];var lt=function(t,e,n,i){var r,s,o,a,l,h,u,c,p,f;if(0===arguments.length)return this._state.slice();if(1===arguments.length){if(d.string(t))return v(this._state,t);if(d.object(t)){for(h=Object.keys(t),o=-1;l=h[++o];)this.state(l,t[l]);return this}}else{if(this._statePipeTarget&&i!==this)return this._statePipeTarget.state(t,e,n,this),this;if(d.string(t)){if("$"===t[0]&&(t=t.slice(1)),"base"===t)return this;if(s=!!e,r=this._getActiveStates(t,!1),this.state(t)!==s&&(c="text"===this.type?"Text":"Style",s?(this._state.push(t),f="ON"):(g(this._state,t),f="OFF"),this["_turn"+c+f](t,r),this.emitPrivate("stateChange:".concat(t),s)),!v(this.options.unpassableStates,t))if(n)this.parent&&this._parent.state(t,e,!0,i||this);else if(this.options.passStateToChildren)for(a=0,u=(p=this._children).length;a<u;a++)p[a].state(t,e,!1,i||this);return this}}},ht=function(t){return this.state(t,!this.state(t))},ut=function(){var t,e,n,i;for(e=0,n=(i=this._state.slice()).length;e<n;e++)t=i[e],this.state(t,!1);return this},ct=function(t){var e,n,i,r;if(t){if(t=_(t),d.quickDomEl(t)&&t!==this)for(this._statePipeTarget=t,n=0,i=(r=this._state).length;n<i;n++)e=r[n],t.state(e,!0)}else!1===t&&delete this._statePipeTarget;return this},pt=function(t,e,n,i){var r,s,o,a,l,h,u,c,p;if(t){for(o=0,l=(u=t.className).length;o<l;o++)r=u[o],this.addClass(r);if(t.fns.length&&!i)for(e&&(p=this._resolveFnStyles(e,n)),a=0,h=(c=t.fns).length;a<h;a++)s=c[a],p&&p[s[0]]||this.style(s[0],s[1])}},ft=function(t,e,n){var i,r,s,o,a,l,h,u,c,p;for(s=0,a=(h=t.className).length;s<a;s++)i=h[s],this.removeClass(i);if(t.fns.length)for(e&&(p=this._resolveFnStyles(e,n)),o=0,l=(u=t.fns).length;o<l;o++)r=u[o],c=p&&p[r[0]]||null,this.style(r[0],c)},dt=function(t,e){var n,i,r,s,o;if(s=this.options.styleAfterInsert&&!this._inserted,this._styles[t]&&this._applyRegisteredStyle(this._styles[t],this._getSuperiorStates(t,e),!1,s),this._providedStatesShared)for(n=0,i=(r=this._getSharedStates(t)).length;n<i;n++)o=r[n],v(this._stateShared,o.string)||this._stateShared.push(o.string),this._applyRegisteredStyle(this._styles[o.string],null,null,s)},yt=function(t,e){var n,i,r,s,o,a;if(this._styles[t]&&this._removeRegisteredStyle(this._styles[t],e,!0),this._providedStatesShared){if(0===(s=this._getSharedStates(t)).length)return;for(i=0,r=s.length;i<r;i++)o=s[i],g(this._stateShared,o.string),(a=this._styles[o.string]).fns.length&&this._stateShared.length&&!n&&(n=this._stateShared.filter(function(e){return!v(e,t)}),e=e.concat(n)),this._removeRegisteredStyle(a,e,!0)}},vt=function(t,e){var n;this._texts&&d.string(n=this._texts[t])&&(this._getSuperiorStates(t,e).length||(this.text=n))},gt=function(t,e){var n;this._texts&&d.string(n=this._texts[t])&&(e=e.filter(function(e){return e!==t}),null==(n=this._texts[e[e.length-1]])&&(n=this._texts.base),this.text=n)},_t=function(t){var e,n,i,r,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._providedStates)return Z;if(e=r=this._state,t)for(r=[],n=0,i=e.length;n<i;n++)(lt=e[n])!==t&&r.push(lt);return s&&this._providedStatesShared?r.concat(this._stateShared):r},mt=function(t,e){var n,i,r,s,o;if((o=this._providedStates.indexOf(t))===this._providedStates.length-1)return Z;for(s=[],i=0,r=e.length;i<r;i++)n=e[i],this._providedStates.indexOf(n)>o&&s.push(n);return s},bt=function(t){var e,n,i,r,s,o;for(e=this._state,s=[],n=0,i=(r=this._providedStatesShared).length;n<i;n++)(o=r[n]).includes(t)&&o.isApplicable(t,e)&&s.push(o);return s},St=function(t,e){var n,i,r,s,o,a,l;for(e&&(t=["base"].concat(t)),a={},i=0,s=t.length;i<s;i++)if(lt=t[i],this._styles[lt]&&this._styles[lt].fns.length)for(r=0,o=(l=this._styles[lt].fns).length;r<o;r++)a[(n=l[r])[0]]=n[1];return a};var xt=function(){return f.template(this)},kt=function(){var t,n,i,r,s,o,a,l,h,u,c,p,f,d,y,v,g;for(s=this.el.cloneNode(!1),d=e.clone(this.options,{existing:s}),f=new this.constructor(this.type,d),a=0,u=(y=this._state).length;a<u;a++)t=y[a],f.state(t,!0);for(l=0,c=(v=this.children).length;l<c;l++)r=v[l],f.append(r.clone());for(o in g=this._eventCallbacks)for(h=0,p=(i=g[o]).length;h<p;h++)n=i[h],f.on(o,n);return f},wt=function(t){var e;return t&&(t=_(t),d.quickDomEl(t)&&((e=t.parent)&&e._removeChild(t),this._children.push(t),this.el.appendChild(t.el),t._refreshParent())),this},Ct=function(t){return t&&(t=_(t),d.quickDomEl(t)&&t.append(this)),this},Ot=function(t){var e;return t&&(t=_(t),d.quickDomEl(t)&&((e=t.parent)&&e._removeChild(t),this._children.unshift(t),this.el.insertBefore(t.el,this.el.firstChild),t._refreshParent())),this},Et=function(t){return t&&(t=_(t),d.quickDomEl(t)&&t.prepend(this)),this},jt=function(t){var e;return t&&this.parent&&(t=_(t),d.quickDomEl(t)&&(e=this.parent._children.indexOf(this),this.parent._children.splice(e+1,0,t),this.el.parentNode.insertBefore(t.el,this.el.nextSibling),t._refreshParent())),this},Tt=function(t){return t&&(t=_(t),d.quickDomEl(t)&&t.after(this)),this},Pt=function(t){var e;return t&&this.parent&&(t=_(t),d.quickDomEl(t)&&(e=this.parent._children.indexOf(this),this.parent._children.splice(e,0,t),this.el.parentNode.insertBefore(t.el,this.el),t._refreshParent())),this},Nt=function(t){return t&&(t=_(t),d.quickDomEl(t)&&t.before(this)),this},qt=function(){var t;return null!=(t=this.parent)&&t._removeChild(this),this},At=function(){var t;if(this.detach(),this.resetState(),this._eventCallbacks)for(t in this._eventCallbacks)this._eventCallbacks[t].length=0;return this},Dt=function(){var t,e,n,i;for(e=0,n=(i=this.children.slice()).length;e<n;e++)t=i[e],this._removeChild(t);return this},Rt=function(t){var e;return t&&(t=_(t),e=this.parent,d.quickDomEl(t)&&t!==this&&t!==this.parent&&(e&&e._removeChild(this,t.parent?void 0:t),t.append(this))),this},Lt=function(){var t,e,n,i;return(e=this.parent)&&(n=f.batch(e.children),i=e.next,(t=e.parent)&&(e.detach(),i?n.insertBefore(i):n.appendTo(t))),this},Ft=function(t){var e;return t&&(t=_(t),d.quickDomEl(t)&&t!==this&&(t.detach(),null!=(e=this.parent)&&e._removeChild(this,t),t._refreshParent())),this},Qt=function(t){return v(this.classList,t)},It=function(t){var e;return-1===(e=this.classList).indexOf(t)&&(e.push(t),this.className=e.length>1?e.join(" "):e[0]),this},Bt=function(t){var e,n;return-1!==(n=(e=this.classList).indexOf(t))&&(e.splice(n,1),this.className=e.length?e.join(" "):""),this},Ht=function(t){return this.hasClass(t)?this.removeClass(t):this.addClass(t),this},zt=function(t){return this.ref=this.options.ref=t,this.attr("data-ref",t),this},Mt=function(){return this.parent},$t=function(t,e){var n;return-1!==(n=this.children.indexOf(t))&&(e?(this.el.replaceChild(e.el,t.el),this._children.splice(n,1,e)):(this.el.removeChild(t.el),this._children.splice(n,1))),this};var Wt=function(t){return d.object(t)&&(this.options=t,this._normalizeOptions(),this._applyOptions(this.options)),this},Jt=function(t){var n,i,r,s,o;if(d.objectPlain(t)&&(e.deep.concat(this,r=this._parseStyles(t)),r._styles))for(n=0,i=(o=Object.keys(r._styles)).length;n<i;n++)s=o[n],(this.state(s)||"base"===s)&&this._applyRegisteredStyle(this._styles[s],this._getActiveStates(s),!1);return this},Kt=function(t){return d.objectPlain(t)&&e.deep.concat(this,this._parseTexts(t)),this},Ut=function(t,e){var n,i,r,s,o,a,l,h,u;if(this.options.passDataToChildren&&this._children.length&&(null!=e?e:e=!0))for(r=0,l=(u=this._children).length;r<l;r++)u[r].applyData(t);if(n=this.options.computers)for(i=this.options.defaults,s=0,h=(a=Object.keys(n)).length;s<h;s++){if(o=a[s],this.options.invokeComputersOnce){if(this._invokedComputers[o])continue;this._invokedComputers[o]=1}t&&t.hasOwnProperty(o)?this._runComputer(o,t[o],t):i&&i.hasOwnProperty(o)&&this._runComputer(o,i[o],t)}return this},Gt=function(t,e,n){return this.options.computers[t].call(this,e,n)};var Vt,Xt,Yt=function(t,e){var n,i,r;if(1===arguments.length){if("string"==typeof t)return this.el.getAttribute(t);if(d.object(t))for(r=Object.keys(t),n=-1;i=r[++n];)this.attr(i,t[i])}else{if(null===e)return this.el.removeAttribute(t);this.el.setAttribute(t,e)}return this},Zt=function(t,e){var n,i,r;if(1===arguments.length){if("string"==typeof t)return this.el[t];if(d.object(t))for(r=Object.keys(t),n=-1;i=r[++n];)this.prop(i,t[i])}else this.el[t]=e;return this};Xt="http://www.w3.org/2000/svg";var te=Vt=function(){var t=function(){function t(e,n){r(this,t),this.type=e,this.options=n,t.count++,"*"===this.type[0]&&(this.svg=!0),this.el=this.options.existing||("text"===this.type?document.createTextNode("string"==typeof this.options.text?this.options.text:""):this.svg?document.createElementNS(Xt,this.type.slice(1)):document.createElement(this.type)),"text"===this.type&&(this.append=this.prepend=this.attr=function(){}),this._parent=null,this._styles={},this._state=[],this._children=[],this._normalizeOptions(),this._applyOptions(),this._attachStateEvents(),this._proxyParent(),this.options.existing&&this._refreshParent(),this.el._quickElement=this}return o(t,[{key:"toJSON",value:function(){var t,n,i,r,s;for(s=[this.type,e.clone.keys(u)(this.options)],i=0,r=(n=this.children).length;i<r;i++)t=n[i],s.push(t.toJSON());return s}}]),t}();return t.count=0,t}.call(void 0);null==Vt.name&&(Vt.name="QuickElement"),function(t){t.prototype._normalizeOptions=W,t.prototype._parseStyles=J,t.prototype._parseTexts=K,t.prototype._applyOptions=U,t.prototype._postCreation=G,t.prototype._attachStateEvents=V,t.prototype._proxyParent=X,t.prototype._unproxyParent=Y}(Vt),function(t){Object.defineProperties(t.prototype,{raw:{get:function(){return this.el}},0:{get:function(){return this.el}},css:{get:function(){return this.style}},replaceWith:{get:function(){return this.replace}},removeListener:{get:function(){return this.off}}})}(Vt),function(t){t.prototype.parentsUntil=tt,t.prototype.parentMatching=et,t.prototype.query=nt,t.prototype.queryAll=it,Object.defineProperties(t.prototype,{children:{get:function(){var t,e,n,i;if(this.el.childNodes.length!==this._children.length)for(this._children.length=0,e=0,n=(i=this.el.childNodes).length;e<n;e++)(t=i[e]).nodeType<4&&this._children.push(f(t));return this._children}},elementChildren:{get:function(){return at(this.children)}},parent:{get:function(){return this._parent&&this._parent.el===this.el.parentNode||d.domDoc(this.el.parentNode)||(this._parent=f(this.el.parentNode)),this._parent}},parents:{get:function(){return rt(this)}},next:{get:function(){return f(this.el.nextSibling)}},nextEl:{get:function(){return f(this.el.nextElementSibling)}},nextElAll:{get:function(){return at(this.nextAll)}},nextAll:{get:function(){var t,e;for(e=[],t=f(this.el.nextSibling);t;)e.push(t),t=t.next;return e}},prev:{get:function(){return f(this.el.previousSibling)}},prevEl:{get:function(){return f(this.el.previousElementSibling)}},prevElAll:{get:function(){return at(this.prevAll)}},prevAll:{get:function(){var t,e;for(e=[],t=f(this.el.previousSibling);t;)e.push(t),t=t.prev;return e}},siblings:{get:function(){return this.prevAll.reverse().concat(this.nextAll)}},elementSiblings:{get:function(){return at(this.siblings)}},child:{get:function(){return this._childRefs||st(this)}},childf:{get:function(){return st(this,!0)}},firstChild:{get:function(){return this.children[0]}},lastChild:{get:function(){var t;return(t=this.children)[t.length-1]}},index:{get:function(){var t;return(t=this.parent)?t.children.indexOf(this):null}},indexType:{get:function(){return ot(this,"type")}},indexRef:{get:function(){return ot(this,"ref")}}})}(Vt),function(t){t.prototype.on=x,t.prototype.once=k,t.prototype.off=w,t.prototype.emit=C,t.prototype.emitPrivate=O,t.prototype._invokeHandlers=E,t.prototype._listenTo=j}(Vt),function(t){t.prototype.state=lt,t.prototype.toggleState=ht,t.prototype.resetState=ut,t.prototype.pipeState=ct,t.prototype._applyRegisteredStyle=pt,t.prototype._removeRegisteredStyle=ft,t.prototype._turnStyleON=dt,t.prototype._turnStyleOFF=yt,t.prototype._turnTextON=vt,t.prototype._turnTextOFF=gt,t.prototype._getActiveStates=_t,t.prototype._getSuperiorStates=mt,t.prototype._getSharedStates=bt,t.prototype._resolveFnStyles=St}(Vt),function(t){Object.defineProperties(t.prototype,{orientation:F,aspectRatio:Q,rect:{get:function(){return this.el.getBoundingClientRect()}},width:{get:function(){return parseFloat(this.style("width"))},set:function(t){return this.style("width",t)}},height:{get:function(){return parseFloat(this.style("height"))},set:function(t){return this.style("height",t)}}}),t.prototype.style=P,t.prototype.styleSafe=N,t.prototype.styleParsed=q,t.prototype.recalcStyle=A,t.prototype.currentStateStyle=D,t.prototype.hide=R,t.prototype.show=L}(Vt),function(t){Object.defineProperties(t.prototype,{html:{get:function(){return this.el.innerHTML},set:function(t){return this.el.innerHTML=t}},text:{get:function(){return this.el.textContent},set:function(t){return this.el.textContent=t}},className:{get:function(){return this.svg?this.attr("class")||"":this.raw.className},set:function(t){return this.svg?this.attr("class",t):this.raw.className=t}},classList:{get:function(){var t;return""===(t=this.className.split(/\s+/))[t.length-1]&&t.pop(),""===t[0]&&t.shift(),t}}}),t.prototype.toTemplate=xt,t.prototype.clone=kt,t.prototype.append=wt,t.prototype.appendTo=Ct,t.prototype.prepend=Ot,t.prototype.prependTo=Et,t.prototype.after=jt,t.prototype.insertAfter=Tt,t.prototype.before=Pt,t.prototype.insertBefore=Nt,t.prototype.detach=qt,t.prototype.remove=At,t.prototype.empty=Dt,t.prototype.wrap=Rt,t.prototype.unwrap=Lt,t.prototype.replace=Ft,t.prototype.hasClass=Qt,t.prototype.addClass=It,t.prototype.removeClass=Bt,t.prototype.toggleClass=Ht,t.prototype.setRef=zt,t.prototype._refreshParent=Mt,t.prototype._removeChild=$t}(Vt),function(t){t.prototype.updateOptions=Wt,t.prototype.updateStateStyles=Jt,t.prototype.updateStateTexts=Kt,t.prototype.applyData=Ut,t.prototype._runComputer=Gt}(Vt),function(t){t.prototype.attr=Yt,t.prototype.prop=Zt}(Vt);var ee={type:"div",ref:void 0,options:{},children:[]};var ne,ie,re,se=function(t,n){var i;switch(!1){case!d.array(t):if(i={},!d.string(t[0]))throw new Error("".concat("Template Parse Error: expected"," string for 'type', got '").concat(String(t[0]),"'"));if(i.type=t[0],t.length>1&&!d.object(t[1])&&null!==t[1])throw new Error("".concat("Template Parse Error: expected"," object for 'options', got '").concat(String(t[1]),"'"));return i.options=t[1]?e.deep.clone(t[1]):ee.options,t[1]&&(i.ref=t[1].id||t[1].ref),i.children=t.slice(2),!1===n?3===t.length&&d.objectPlain(t[2])&&!d.template(t[2])&&(i.children=t[2]):i.children=i.children.map(de.template),i;case!(d.string(t)||d.domText(t)):return{type:"text",options:{text:t.textContent||t},children:ee.children};case!d.domEl(t):return{type:t.nodeName.toLowerCase(),ref:t.id,options:e.clone.keys(h)(t),children:ee.children.map.call(t.childNodes,de.template)};case!d.quickDomEl(t):return{type:t.type,ref:t.ref,options:e.clone.deep.notKeys(["relatedInstance","related"])(t.options),children:t.children.map(de.template)};case!d.template(t):return t;default:throw new Error("".concat("Template Parse Error: expected"," (array || string || domEl || quickDomEl || template), got ").concat(String(t)))}};ne=["relatedInstance","related","data"],ie=["children","_childRefs"];var oe,ae=function(t,n,i){var r,s,o,a,l,h,u,c,p,f,y,v,g,_;if(i&&(o={options:function(t){return e(t,i)}}),d.array(n)?n=se(n,!1):n&&(void 0===(_=n).type&&void 0===_.ref&&void 0===_.options&&void 0===_.children)&&(n={options:n}),y=e.deep.nullDeletes.notKeys(ie).notDeep(ne).transform(o).clone(t,n),s=t.children,p=(null!=n?n.children:void 0)||[],y.children=[],d.array(p))for(l=Math.max(s.length,p.length),a=-1;++a!==l;)h=f=!1,r=s[a],u=p[a],c=function(){switch(!1){case!d.template(u):return u;case!d.array(u):return h=se(u);case!d.string(u):return h={type:"text",options:{text:u}};case!(!u&&!i):return f=!0;default:return h=u||!0}}(),f?c=r:h&&(c=r?r.extend(c,i):new he(e.clone(ee,c))),y.children.push(c);else if(d.object(p))for(v in p=e.allowNull.clone(p),y.children=re(p,s,i),g=p)u=g[v],c=d.objectPlain(u)&&!d.template(u)?u:se(u),y.children.push(new he(c)),delete g[v];return y};re=function(t,e,n){var i,r,s,o,a,l;if(e.length){for(l=[],r=0,s=e.length;r<s;r++){if(i=e[r],o=t[i.ref])a=i.extend(o,n),delete t[i.ref];else{if(null===o){delete t[i.ref];continue}a=function(){switch(!1){case!n:return i.extend(null,n);case!Object.keys(t).length:return i.extend();default:return i}}()}a.children=re(t,a.children),l.push(a)}return l}return e};var le,he=oe=function(){function t(n,i){if(r(this,t),d.template(n))return n;n=i?se(n):n,e(this,n)}return o(t,[{key:"extend",value:function(e,n){return new t(ae(this,e,n))}},{key:"spawn",value:function(t,n,i){var r,s,o,a,l,h,u,c;if(t&&t.data&&(i=t.data,1===Object.keys(t).length&&(t=null)),t||n){var p=ae(this,t,n);u=p.options,o=p.children,c=p.type}else u=this.options,o=this.children,c=this.type,u=e.clone(u);if(a=f.create([c,u]),o)for(s=u.passDataToChildren?i||u.data:void 0,l=0,h=o.length;l<h;l++)r=o[l],a.append(r.spawn(null,null,s));return a._postCreation(i),a}}]),t}();null==oe.name&&(oe.name="QuickTemplate"),Object.defineProperty(oe.prototype,"child",{get:function(){return this._childRefs||st(this)}}),f.template=function(t){return new oe(t,!0)},f.isTemplate=function(t){return d.template(t)};var ue=le=function(){function t(e,n){r(this,t),this.returnResults=n,this.elements=e.map(function(t){return f(t)})}return o(t,[{key:"reverse",value:function(){return this.elements=this.elements.reverse(),this}},{key:"return",value:function(t){return t?(this.returnResults=!0,this):this.lastResults}}]),t}();null==le.name&&(le.name="QuickBatch"),Object.keys(te.prototype).concat("css","replaceWith","html","text").forEach(function(t){return le.prototype[t]=function(e){var n,i;return i=this.lastResults=function(){var i,r,s,o;for(o=[],i=0,r=(s=this.elements).length;i<r;i++){var a;if(n=s[i],"html"===t||"text"===t)e?o.push(n[t]=e):o.push(n[t]);else o.push((a=n)[t].apply(a,arguments))}return o}.apply(this,arguments),this.returnResults?i:this}}),f.batch=function(t,e){if(!d.iterable(t))throw new Error("Batch: expected an iterable, got ".concat(String(t)));return new le(t,e)};var ce,pe,fe;for(pe=0,fe=(ce=["link:a","anchor:a","a","text","div","span","h1","h2","h3","h4","h5","h6","header","footer","section","button","br","ul","ol","li","fieldset","input","textarea","select","option","form","frame","hr","iframe","img","picture","main","nav","meta","object","pre","style","table","tbody","th","tr","td","tfoot","video"]).length;pe<fe;pe++)!function(t){var e,n,i;e=i=t,v(t,":")&&(e=(n=t.split(":"))[0],i=n[1]),f[e]=function(){return f.apply(void 0,[i].concat(Array.prototype.slice.call(arguments)))}}(ce[pe]);c=te,p=B,f.QuickElement=te,f.QuickTemplate=he,f.QuickWindow=B,f.QuickBatch=ue,f.version="1.0.93",f.CSS=t;var de=f;return de});